---
title: 'What is the difference between Stubs, Mocks, Fakes and Spies?'
excerpt: 'The lines between the different test doubles are blurred when you use a Mocking library like MOQ. We can use Mocks for almost everything, but whats the difference between Stubs, Mocks, Fakes and Spies'
tags:
    - 'testing'
---

The lines between the different test doubles are blurred when using a Mocking library like [Moq](https://github.com/moq/moq4).

I use mocks for almost everything, but I think it's still worthwhile to know the difference between Stubs, Mocks, Fakes and Spies. If nothing else, we will know what people are talking about when they use the different terms.

## Stub

A stub is an object that provides (canned) hardcoded values to method calls. It always returns the same output regardless of the input.

Below is the stubbed version using Moq of a service where the OnPing() function always returns "pong" regardless of the input.

```csharp
_service.Setup(x => x.OnPing(It.IsAny<int>())).Returns("pong");
```

An example can be an object that needs to grab some data from the database to respond to a method call. Instead of the actual object, we can introduce a stub and define what data should be returned.

## Mock

A mock is similar to a stub, but the behaviour of the mocked interface can be changed dynamically based on scenarios. It also lets you set expectations on scenarios like how often a method was called and with what arguments. In the test assertion, we can verify that all expected actions were performed.

Below is the mocked version using Moq of a service where the OnPing() function behaves differently for different inputs. We also verify that the correct calls were received.

```csharp
_service.Setup(x => x.OnPing(1)).Returns("pong1");
_service.Setup(x => x.OnPing(2)).Returns("pong2");
_service.Verify(x => x.OnPong(1)), Times.Once);
_service.Verify(x => x.OnPing(It.IsAny<int>())), Times(2));
```

A mock can be used anywhere where we would use a stub, but we need to verify multiple more specific behaviours. An example could be to be check that we are sending an email only once and with the correct arguments or that all the logs are logged correctly.

## Fake

A Fake is an object that has a concrete implementation that works similar to the actual implementation. It is a simplified version of production code. It does not affect the behaviour of the test but simplifies the implementation of the test by removing heavyweight dependencies.

It should be used sparingly and only in cases where a Stub or Mock is not usable.

Below is an implementation of a Fake repository

```csharp
public class FakeRepository : IRepository
{
    private Dictionary<int, bool> _values = new Dictionary<int, bool>();

    public bool IsValid(int id)
    {
        return _values[id];
    }

    public void Add(int id, bool valid)
    {
        _values.Add(id, open);
    }
}
```

An example could be using AWS S3 in production, but adding a fake that saves files to disk for testing purposes.

## Spy

A spy allows us to verify that a method was called rather than setting an expectation that it should be called. Unlike a mock, it executes the original code rather than a mocked or stubbed instance.

## Conclusion

Hopefully, now, you understand the difference between the test doubles and are not confused when people talk about fakes, stubs or mocks.
