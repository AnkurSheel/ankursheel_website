---
published: true
author: 'Ankur Sheel'
date: '2020-01-09'
slug: 'creating-a-sns-topic-for-a-ses-not-in-the-default-provider'
title: 'Creating a SNS topic for a SES not in the default provider'
excerpt:
    'How can you access resources created in a different AWS region with terraform? I ran into this when trying to
    access SES created in a different region to the rest of our infrastructure.'
tags:
    - 'terraform'
    - 'devops'
    - 'aws'
featuredImage: ''
featuredImagePosition: ''
imageFacebook: './image-facebook.png'
imageTwitter: './image-twitter.png'
---

Lets assume that most of our infrastructure is in _ap-southeast-2 (Sydney)_. But, our SES is setup in _us-west-2
(Oregon)_. We also want to create SNS topics and SQS queues so that we can handle bounce notifications. Now since SES is
in a different region our SNS topics also need to be in that region. So how do we tell terraform to create the topics in
the SES region?

## Solution

### Step 1

Create providers.

```hcl{7}
provider "aws" {
  region = "ap-southeast-2"
}

provider "aws" {
  region = "us-west-2"
  alias  = "ses_aws"
}
```

-   **ap-southeast-2**: The default provider configuration.
-   **us-west-2**: This is the additional provider configuration. Setting the **_Alias_** allows us to create more than
    1 providers.

## Step 2

For the resources, we want to use the _us-west-2_ region we specify the _provider_ parameter and set it to be equal to
the _alias_. If a _provider_ parameter is not specified, it will fall back to using the provider that doesn't have an
alias.

```hcl{7,14}
resource "aws_sqs_queue" "example-queue" {
  name                      = "example_queue"
}

resource "aws_sns_topic" "example-topic" {
  name     = "example_topic"
  provider = aws.ses_aws
}
```

In the above snippet, _example-queue_ will be created in _ap-southeast-2_ but, _example-topic_ will be created in
_us-west-2_.

## Conclusion

By creating additional providers and specifiying the _provider_ parameter in a resource, we can change its region.
