---
title: 'How do you upload a PDF received from an API to AWS S3?'
excerpt: 'A code snippet to encrypt and upload a PDF file to an AWS S3 bucket received as a Stream from an external API'
tags:
    - snippet
    - AWS
    - S3
---

## Problem

How do you upload a PDF file that was generated by a 3rd party API to an AWS S3 bucket and protect it using server-side
encryption?

## Solution

Let's assume that we have got the pdf as a stream from calling our API endpoint.

```csharp
Stream pdfStream = api.GetPdfAsStream();
```

### Snippet

Let's see the code before talking about what is happening.

```csharp
var s3Client = new AmazonS3Client(RegionEndpoint.USEast1);
var s3Request = new PutObjectRequest
{
    BucketName = "Bucket Name",
    Key = Guid.NewGuid().ToString(),
    InputStream = pdfStream,
    ServerSideEncryptionMethod = ServerSideEncryptionMethod.AWSKMS,
    ContentType = "application/pdf",
    Headers = { ContentDisposition = $"attachment; \"filename=\"File Name\"" },
};

var s3Response = await s3Client.PutObjectAsync(s3Request);
```

-   **_Line 1_**: Setup the S3 client with the region we want to connect to
-   **_Line 2_**: Create a new `PutObjectRequest` because we want to upload a file to S3.
-   **_Line 4_**: **_BucketName_**: Set the bucket name in which the PDF needs to be put.
-   **_Line 5_**: **_Key_**: Create an unique key to identify the object in S3.
-   **_Line 6_**: **_InputStream_**: Set the the inputStream to the PDF stream that we received from the API.
-   **_Line 7_**: **_ServerSideEncryptionMethod_**: Use the AWS Key Management Service to encrypt the PDF.
-   **_Line 8_**: **_ContentType_**: Set the content type to _application/pdf_ so that the browser can show the file as
    a PDF.
-   **_Line 9_**: **_Headers_**: Add some common headers
    -   _ContentDisposition_ to _attachment_ to indicate that the file should be downloaded.
    -   _filename_ to the name of the File.
-   **_Line 12_**: Start the asynchronous execution of the `PutObject` operation.

## Conclusion

Using this snippet, we are able to upload a PDF to a S3 bucket and encrypt it using server-side encryption.
