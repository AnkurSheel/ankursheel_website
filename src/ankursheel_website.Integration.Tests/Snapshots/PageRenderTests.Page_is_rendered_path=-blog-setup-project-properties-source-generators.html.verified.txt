
<!DOCTYPE html>
<html lang="en" class="min-h-screen">
<head>
    

<title>Ankur Sheel - How to set up the project properties for Source Generators</title>
<meta charset="utf-8"/>

<!-- Google Tag Manager -->

<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="A guide to setting up the project properties that we need to create and use source generators"/>
<link href="/assets/styles.css" rel="stylesheet"/>
<link href="/assets/code-styles/obsidian.min.css" rel="stylesheet"/>
<link rel="canonical" href="https://www.ankursheel.com/blog/setup-project-properties-source-generators"/>

<meta itemProp="name" content="How to set up the project properties for Source Generators"/>
<meta itemProp="description" content="A guide to setting up the project properties that we need to create and use source generators"/>
    <meta itemProp="image" content="https://www.ankursheel.com/assets/images/social/setup-project-properties-source-generators-facebook.png"/>
<meta property="og:url" content="https://www.ankursheel.com/blog/setup-project-properties-source-generators"/>
<meta property="og:type" content="article"/>
<meta property="og:title" content="How to set up the project properties for Source Generators"/>
<meta property="og:description" content="A guide to setting up the project properties that we need to create and use source generators"/>
    <meta property="og:image" content="https://www.ankursheel.com/assets/images/social/setup-project-properties-source-generators-facebook.png"/>
    <meta property="og:image:secure_url" content="https://www.ankursheel.com/assets/images/social/setup-project-properties-source-generators-facebook.png"/>
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:site" content="ankur_sheel"/>
<meta name="twitter:creator" content="ankur_sheel"/>
<meta name="twitter:title" content="How to set up the project properties for Source Generators"/>
<meta name="twitter:description" content="A guide to setting up the project properties that we need to create and use source generators"/>
    <meta name="twitter:image" content="https://www.ankursheel.com/assets/images/social/setup-project-properties-source-generators-twitter.png"/>
    <meta name="twitter:image:secure_url" content="https://www.ankursheel.com/assets/images/social/setup-project-properties-source-generators-twitter.png"/>

</head>
<body class="font-sans font-normal leading-relaxed font-base text-gray-800 min-h-screen bg-gray-100">
<header class="sticky top-0 bg-white shadow-lg z-10">
    

<!-- https://www.section.io/engineering-education/creating-a-responsive-navigation-bar-using-tailwind-css-and-javascript/ -->

<nav>
    <div class="max-w-6xl mx-auto px-4">
        <div class="flex justify-between">
            <div class="flex space-x-7 items-center">
                <!-- Website Logo -->
                <div>
                    <a href="/" class="flex items-center py-4 px-2 ">
                        <span class="font-semibold text-gray-500 text-lg hover:text-green-500">
                            Ankur Sheel
                        </span
                        >
                    </a>
                </div>
                <ul class="hidden lg:flex items-center space-x-1">
                        <li class="py-4 px-2 text-gray-500 font-semibold hover:text-green-500 transition-all transform hover:scale-110">
                            <a href="/about">About</a>
                        </li>
                        <li class="py-4 px-2 text-gray-500 font-semibold hover:text-green-500 transition-all transform hover:scale-110">
                            <a href="/blog">All Posts</a>
                        </li>
                        <li class="py-4 px-2 text-gray-500 font-semibold hover:text-green-500 transition-all transform hover:scale-110">
                            <a href="/tags">All Tags</a>
                        </li>
                        <li class="py-4 px-2 text-gray-500 font-semibold hover:text-green-500 transition-all transform hover:scale-110">
                            <a href="/contact">Contact</a>
                        </li>
                        <li class="py-4 px-2 text-gray-500 font-semibold hover:text-green-500 transition-all transform hover:scale-110">
                            <a href="/cv">CV</a>
                        </li>
                        <li class="py-4 px-2 text-gray-500 font-semibold hover:text-green-500 transition-all transform hover:scale-110">
                            <a href="/impossible-list">Impossible List</a>
                        </li>
                </ul>
            </div>

            <ul class="hidden lg:flex items-center space-x-3">
                <li>
                    <a role="button" class="" target="_blank" rel="noopener noreferrer" href="/rss.xml" title="RSS">
                        <img class="h-8 mr-2 border-none" src="/assets/images/rss.svg" alt="RSS">
                    </a>
                </li>
                <li>
                    <a role="button" class="inline-flex items-center bg-green-400 text-white p-2 rounded-md text-2xl drop-shadow-lg hover:bg-green-800" target="_blank" rel="noopener noreferrer" href="https://www.buymeacoffee.com/ankursheel" title="Did you learn something or find this summary interesting?">
                        <img class="h-8 mr-2 border-none" src="/assets/images/bmc-logo.svg" alt="Buy Me A Coffee">
                        <p class="font-cookie">Buy me a book</p>
                    </a>
                </li>
            </ul>

            <div class="lg:hidden flex items-center">
                <button class="outline-none mobile-menu-button" aria-label="Mobile Menu">
                    <svg class="h-6 w-6 fill-current" viewBox="0 0 24 24">
                        <path fill-rule="evenodd"
                              d="M4 5h16a1 1 0 0 1 0 2H4a1 1 0 1 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2z"/>
                    </svg>
                </button>
            </div>

        </div>
        <div class="hidden mobile-menu">
            <ul class="flex flex-col">
                    <li class="text-sm px-2 py-4 hover:bg-green-500 transition duration-300">
                        <a href="/about" class="block">About</a>
                    </li>
                    <li class="text-sm px-2 py-4 hover:bg-green-500 transition duration-300">
                        <a href="/blog" class="block">All Posts</a>
                    </li>
                    <li class="text-sm px-2 py-4 hover:bg-green-500 transition duration-300">
                        <a href="/tags" class="block">All Tags</a>
                    </li>
                    <li class="text-sm px-2 py-4 hover:bg-green-500 transition duration-300">
                        <a href="/contact" class="block">Contact</a>
                    </li>
                    <li class="text-sm px-2 py-4 hover:bg-green-500 transition duration-300">
                        <a href="/cv" class="block">CV</a>
                    </li>
                    <li class="text-sm px-2 py-4 hover:bg-green-500 transition duration-300">
                        <a href="/impossible-list" class="block">Impossible List</a>
                    </li>
            </ul>
        </div>
    </div>
</nav>

</header>
<main class="mx-auto max-w-prose p-8 prose prose-xl prose-purple">
    <h1 class="text-center">How to set up the project properties for Source Generators</h1>
    <div class="flex flex-col min-h-screen">
        <article>
            
<div class="prose-sm italic ">
    <div class="flex justify-evenly items-center">
        <i>Last Updated On: 23-Jun-2021</i>
        <i class="font-bold">
            Reading Time: 2 min
        </i>
    </div>

    <div class="flex flex-row flex-wrap gap-1 place-content-center">
            <div class="flex-initial border-2 border-black p-2 m-2 border rounded-xl">
                <a role="button" href="/tags/csharp" class="badge text-black bg-grey-light no-underline">csharp</a>
            </div>
            <div class="flex-initial border-2 border-black p-2 m-2 border rounded-xl">
                <a role="button" href="/tags/productivity" class="badge text-black bg-grey-light no-underline">productivity</a>
            </div>
            <div class="flex-initial border-2 border-black p-2 m-2 border rounded-xl">
                <a role="button" href="/tags/snippet" class="badge text-black bg-grey-light no-underline">snippet</a>
            </div>
            <div class="flex-initial border-2 border-black p-2 m-2 border rounded-xl">
                <a role="button" href="/tags/source-generator" class="badge text-black bg-grey-light no-underline">source generator</a>
            </div>
            <div class="flex-initial border-2 border-black p-2 m-2 border rounded-xl">
                <a role="button" href="/tags/dev-tools" class="badge text-black bg-grey-light no-underline">dev tools</a>
            </div>
    </div>
</div>

<html><head></head><body><p>Source Generators are an excellent way to reduce boilerplate and repetitive code that we have to write. This post will look at the project properties we need to set on both the source generator and consumer projects.</p>
<h2 id="source-generator-project-properties">Source Generator Project Properties</h2>
<p>A source generator is a .Net class.</p>
<h3 id="create-a-new-solution-and-a-library-project">Create a new solution and a library project</h3>
<p>The empty project is targeting Net5.0. I have also enabled nullables.</p>
<pre><code class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">PropertyGroup</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">TargetFramework</span>&gt;</span>net5.0<span class="hljs-tag">&lt;/<span class="hljs-name">TargetFramework</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Nullable</span>&gt;</span>enable<span class="hljs-tag">&lt;/<span class="hljs-name">Nullable</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">WarningsAsErrors</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">WarningsAsErrors</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">PropertyGroup</span>&gt;</span>
</code></pre>
<h3 id="add-the-required-packages">Add the required packages</h3>
<p>Next, we will add the CodeAnalysis libraries from NuGet.</p>
<pre><code class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">ItemGroup</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">PackageReference</span> <span class="hljs-attr">Include</span>=<span class="hljs-string">"Microsoft.CodeAnalysis.Analyzers"</span> <span class="hljs-attr">Version</span>=<span class="hljs-string">"3.3.2"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">PackageReference</span> <span class="hljs-attr">Include</span>=<span class="hljs-string">"Microsoft.CodeAnalysis.CSharp.Workspaces"</span> <span class="hljs-attr">Version</span>=<span class="hljs-string">"3.8.0"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ItemGroup</span>&gt;</span>
</code></pre>
<h2 id="consumer-project-properties">Consumer Project Properties</h2>
<p>In the consumer project, we need to add a reference to the source generator. This can be done as either a project reference or a NuGet package.</p>
<h3 id="reference-the-project-in-debug-mode">Reference the project in Debug mode</h3>
<p>In Debug mode, we reference the project directly so that it's easier for development.</p>
<pre><code class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">ItemGroup</span> <span class="hljs-attr">Condition</span>=<span class="hljs-string">"'$(Configuration)'=='Debug'"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ProjectReference</span> <span class="hljs-attr">Include</span>=<span class="hljs-string">"..\\SourceGenerator\\SourceGenerator.csproj"</span> <span class="hljs-attr">OutputItemType</span>=<span class="hljs-string">"Analyzer"</span> <span class="hljs-attr">ReferenceOutputAssembly</span>=<span class="hljs-string">"false"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ItemGroup</span>&gt;</span>
</code></pre>
<ul>
<li><strong><em>OutputItemType</em></strong>: Source generators as packaged and deployed the same way as Roslyn Analysers, so we need to tell the compiler that it is not a standard project reference.</li>
<li><strong><em>ReferenceOutputAssembly</em></strong>: Tells the compiler not to include the source generator project in the published output, i.e. the bin folder.</li>
</ul>
<h3 id="reference-the-nuget-package-in-release-mode">Reference the NuGet package in Release mode</h3>
<p>In Release mode, we reference the NuGet package so that we can test the package.</p>
<pre><code class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">ItemGroup</span> <span class="hljs-attr">Condition</span>=<span class="hljs-string">"'$(Configuration)'=='Release'"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">PackageReference</span> <span class="hljs-attr">Include</span>=<span class="hljs-string">"SourceGenerator"</span> <span class="hljs-attr">Version</span>=<span class="hljs-string">"x.y.z"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ItemGroup</span>&gt;</span>
</code></pre>
<h3 id="writing-the-generated-code-to-disk">Writing the generated code to disk</h3>
<p>By default, the generated code is not written to disk. However, when writing a source generator, looking at the generated code can be helpful.</p>
<pre><code class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">PropertyGroup</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">EmitCompilerGeneratedFiles</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">EmitCompilerGeneratedFiles</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">CompilerGeneratedFilesOutputPath</span>&gt;</span>GeneratedFiles<span class="hljs-tag">&lt;/<span class="hljs-name">CompilerGeneratedFilesOutputPath</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">PropertyGroup</span>&gt;</span>
</code></pre>
<ul>
<li><strong><em>EmitCompilerGeneratedFiles</em></strong>: This flag tells the compiler to write the generated files to disk</li>
<li><strong><em>CompilerGeneratedFilesOutputPath</em></strong>: By default, the generated code is written to the <strong><em>obj/generated</em></strong> folder. This property allows us to override the folder. In this case, I am writing them to a GeneratedFiles folder</li>
</ul>
<h3 id="excluding-the-generated-folder">Excluding the generated folder</h3>
<p>We will need to exclude the generated folder, or the compiler will try to add the same file twice - one from disk and one from the code generator.</p>
<pre><code class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">ItemGroup</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Compile</span> <span class="hljs-attr">Remove</span>=<span class="hljs-string">"$(CompilerGeneratedFilesOutputPath)/*/**/*.cs"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ItemGroup</span>&gt;</span>
</code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>Now, we have our projects set up to start creating source generators and consuming the generated code.</p>
<p>If you want to look at the code, you can find it <a href="https://github.com/AnkurSheel/CSharpSourceGenerators">here</a></p>
</body></html>



<aside class="hidden md:block">
        <div class="flex justify-center gap-x-5 ">
            <a class="bg-social-twitter social-button" href="https://twitter.com/intent/tweet?url=https://www.ankursheel.com/blog/setup-project-properties-source-generators&text=A%20guide%20to%20setting%20up%20the%20project%20properties%20that%20we%20need%20to%20create%20and%20use%20source%20generators via @ankur_sheel" target="_blank" rel="noopener noreferrer">Tweet this Article</a>
            <a class="bg-social-linkedin social-button" href="https://www.linkedin.com/sharing/share-offsite/?url=https://www.ankursheel.com/blog/setup-project-properties-source-generators"target="_blank" rel="noopener noreferrer">Share on Linkedin</a>
        </div>
</aside>



        </article>
    </div>
</main>


<script src="/assets/js/blog.js"></script>
    <script data-goatcounter="https://ankursheel.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>



    <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="ankursheel" data-description="Support me on Buy me a coffee!" data-message="Did you learn something or find this summary interesting? Buy me a coffee" data-color="#40DCA5" data-position="Right" data-x_margin="18" data-y_margin="18"></script>


</body>
</html>
