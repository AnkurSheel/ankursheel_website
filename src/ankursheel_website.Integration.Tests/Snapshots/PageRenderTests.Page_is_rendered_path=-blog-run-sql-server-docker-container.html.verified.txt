
<!DOCTYPE html>
<html lang="en" class="min-h-screen">
<head>
    

<title>Ankur Sheel - How to run SQL Server in a Docker container</title>
<meta charset="utf-8"/>

<!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MG9PGWH');</script>
    <!-- End Google Tag Manager -->

<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="In this post, we will see how we can run SQL Server on Docker using docker-compose and managing the image and environment variables in a docker file"/>
<link href="/assets/styles.css" rel="stylesheet"/>
<link href="/assets/code-styles/obsidian.min.css" rel="stylesheet"/>
<link rel="canonical" href="https://www.ankursheel.com/blog/run-sql-server-docker-container"/>

<meta itemProp="name" content="How to run SQL Server in a Docker container"/>
<meta itemProp="description" content="In this post, we will see how we can run SQL Server on Docker using docker-compose and managing the image and environment variables in a docker file"/>
    <meta itemProp="image" content="https://www.ankursheel.com/assets/images/social/run-sql-server-docker-container-facebook.png"/>
<meta property="og:url" content="https://www.ankursheel.com/blog/run-sql-server-docker-container"/>
<meta property="og:type" content="article"/>
<meta property="og:title" content="How to run SQL Server in a Docker container"/>
<meta property="og:description" content="In this post, we will see how we can run SQL Server on Docker using docker-compose and managing the image and environment variables in a docker file"/>
    <meta property="og:image" content="https://www.ankursheel.com/assets/images/social/run-sql-server-docker-container-facebook.png"/>
    <meta property="og:image:secure_url" content="https://www.ankursheel.com/assets/images/social/run-sql-server-docker-container-facebook.png"/>
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:site" content="ankur_sheel"/>
<meta name="twitter:creator" content="ankur_sheel"/>
<meta name="twitter:title" content="How to run SQL Server in a Docker container"/>
<meta name="twitter:description" content="In this post, we will see how we can run SQL Server on Docker using docker-compose and managing the image and environment variables in a docker file"/>
    <meta name="twitter:image" content="https://www.ankursheel.com/assets/images/social/run-sql-server-docker-container-twitter.png"/>
    <meta name="twitter:image:secure_url" content="https://www.ankursheel.com/assets/images/social/run-sql-server-docker-container-twitter.png"/>

</head>
<body class="font-sans font-normal leading-relaxed font-base text-gray-800 min-h-screen bg-gray-100">
    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MG9PGWH"
                height="0" width="0" style="display:none;visibility:hidden">
        </iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->
<header class="sticky top-0 bg-white shadow-lg z-10 w-full">
    

<!-- https://www.section.io/engineering-education/creating-a-responsive-navigation-bar-using-tailwind-css-and-javascript/ -->

<nav>
    <div class="max-w-6xl mx-auto px-4">
        <div class="flex justify-between">
            <div class="flex space-x-7 items-center">
                <!-- Website Logo -->
                <div>
                    <a href="/" class="flex items-center py-4 px-2 ">
                        <span class="font-semibold text-gray-500 text-lg hover:text-green-500">
                            Ankur Sheel
                        </span
                        >
                    </a>
                </div>
                <ul class="hidden lg:flex items-center space-x-1">
                        <li class="py-4 px-2 text-gray-500 font-semibold hover:text-green-500 transition-all transform hover:scale-110">
                            <a href="/about">About</a>
                        </li>
                        <li class="py-4 px-2 text-gray-500 font-semibold hover:text-green-500 transition-all transform hover:scale-110">
                            <a href="/blog">All Posts</a>
                        </li>
                        <li class="py-4 px-2 text-gray-500 font-semibold hover:text-green-500 transition-all transform hover:scale-110">
                            <a href="/tags">All Tags</a>
                        </li>
                        <li class="py-4 px-2 text-gray-500 font-semibold hover:text-green-500 transition-all transform hover:scale-110">
                            <a href="/contact">Contact</a>
                        </li>
                        <li class="py-4 px-2 text-gray-500 font-semibold hover:text-green-500 transition-all transform hover:scale-110">
                            <a href="/cv">CV</a>
                        </li>
                        <li class="py-4 px-2 text-gray-500 font-semibold hover:text-green-500 transition-all transform hover:scale-110">
                            <a href="/impossible-list">Impossible List</a>
                        </li>
                </ul>
            </div>

            <ul class="hidden lg:flex items-center space-x-3">
                <li>
                    <a role="button" class="" target="_blank" rel="noopener noreferrer" href="/rss.xml" title="RSS">
                        <img class="h-8 mr-2 border-none" src="/assets/images/rss.svg" alt="RSS">
                    </a>
                </li>
                <li>
                    <a role="button" class="inline-flex items-center bg-green-400 text-white p-2 rounded-md text-2xl drop-shadow-lg hover:bg-green-800" target="_blank" rel="noopener noreferrer" href="https://www.buymeacoffee.com/ankursheel" title="Did you learn something or find this summary interesting?">
                        <img class="h-8 mr-2 border-none" src="/assets/images/bmc-logo.svg" alt="Buy Me A Coffee">
                        <p class="font-cookie">Buy me a coffee</p>
                    </a>
                </li>
            </ul>

            <div class="lg:hidden flex items-center">
                <button class="outline-none mobile-menu-button" aria-label="Mobile Menu">
                    <svg class="h-6 w-6 fill-current" viewBox="0 0 24 24">
                        <path fill-rule="evenodd"
                              d="M4 5h16a1 1 0 0 1 0 2H4a1 1 0 1 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2z"/>
                    </svg>
                </button>
            </div>

        </div>
        <div class="hidden mobile-menu">
            <ul class="flex flex-col">
                    <li class="text-sm px-2 py-4 hover:bg-green-500 transition duration-300">
                        <a href="/about" class="block">About</a>
                    </li>
                    <li class="text-sm px-2 py-4 hover:bg-green-500 transition duration-300">
                        <a href="/blog" class="block">All Posts</a>
                    </li>
                    <li class="text-sm px-2 py-4 hover:bg-green-500 transition duration-300">
                        <a href="/tags" class="block">All Tags</a>
                    </li>
                    <li class="text-sm px-2 py-4 hover:bg-green-500 transition duration-300">
                        <a href="/contact" class="block">Contact</a>
                    </li>
                    <li class="text-sm px-2 py-4 hover:bg-green-500 transition duration-300">
                        <a href="/cv" class="block">CV</a>
                    </li>
                    <li class="text-sm px-2 py-4 hover:bg-green-500 transition duration-300">
                        <a href="/impossible-list" class="block">Impossible List</a>
                    </li>
            </ul>
        </div>
    </div>
</nav>

</header>

<main class="mx-auto max-w-prose p-4 prose prose-xl prose-purple">
    <h1 class="text-center">How to run SQL Server in a Docker container</h1>
    <div class="flex flex-col min-h-screen">
        <article>
            
<div class="prose-sm italic ">
    <div class="flex justify-evenly items-center">
        <i>Last Updated On: 29-Jun-2021</i>
        <i class="font-bold">
            Reading Time: 3 min
        </i>
    </div>

    <div class="flex flex-row flex-wrap gap-1 place-content-center">
            <div class="flex-initial border-2 border-black p-2 m-2 border rounded-xl">
                <a role="button" href="/tags/docker" class="badge text-black bg-grey-light no-underline">docker</a>
            </div>
            <div class="flex-initial border-2 border-black p-2 m-2 border rounded-xl">
                <a role="button" href="/tags/snippet" class="badge text-black bg-grey-light no-underline">snippet</a>
            </div>
    </div>
</div>

<html><head></head><body><p>In this post, we will see how we can run SQL Server on Docker. We will be launching the SQL server container using docker-compose and managing the image and environment variables in a docker file.</p>
<h3 id="docker-compose-file">Docker Compose file</h3>
<p>To launch a SQL Server container, we will first create a <code>docker-compose.yml</code> file. I like to keep my docker scripts in a folder called <strong><em>build.</em></strong></p>
<pre><code class="language-yaml hljs"><span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>

<span class="hljs-attr">services:</span>
<span class="hljs-attr">    db:</span>
<span class="hljs-attr">        container_name:</span> sql_server_db
<span class="hljs-attr">        build:</span>
<span class="hljs-attr">            context:</span> ./../
<span class="hljs-attr">            dockerfile:</span> ./build/mssqlserver.Dockerfile
<span class="hljs-attr">        ports:</span>
<span class="hljs-bullet">            -</span> <span class="hljs-string">'1433:1433'</span>
</code></pre>
<ul>
<li><strong>Line #1</strong>: This denotes that we are using version 3.8 of Docker compose so that Docker can provide the appropriate features.</li>
<li><strong>Line #3</strong> This section defines all the different containers we will create.</li>
<li><strong>Line #4</strong>: The name of the SQL Server Database service. <em>Can be anything.</em></li>
<li><strong>Line #5</strong>: A custom container name rather than a generated default name so that we can easily find the container in Docker.</li>
<li><strong>Line #6</strong>: Configuration options that are applied at build time</li>
<li><strong>Line #7:</strong> Setting this to <code>.\..\</code> allows the build process to access any of the files in the root folder.</li>
<li><strong>Line #8</strong>: Set the path to the docker file relative to the context path.</li>
<li><strong>Line #9-10</strong>: SQL Server is listening on port 1433 in the container, and we want to expose it on port 1433, on the host.</li>
</ul>
<h3 id="docker-file-for-sql-server">Docker file for SQL Server</h3>
<p>We can start by adding the base image and environment variables to the docker file.</p>
<pre><code class="language-docker hljs"><span class="hljs-keyword">FROM</span> mcr.microsoft.com/mssql/server:<span class="hljs-number">2017</span>-latest

ARG SA_PASSWORD=<span class="hljs-string">"Password1!"</span>
<span class="hljs-keyword">ENV</span> SA_PASSWORD=$SA_PASSWORD
<span class="hljs-keyword">ENV</span> ACCEPT_EULA=<span class="hljs-string">"Y"</span>

<span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">1433</span>
</code></pre>
<ul>
<li><strong>Line #1</strong>: Pull down the SQL Server 2017 container image.</li>
<li><strong>Line #3</strong>: Set the SA_PASSWORD as a variable so that it can be reused.</li>
<li><strong>Line #4</strong>: Specify the strong password that meets SQL Server password requirements as an environment variable.</li>
<li><strong>Line #5</strong>: Sets the environment variable to confirm our acceptance of the End-User Licensing Agreement.</li>
<li><strong>Line #7</strong>: Expose the port to access it from composed containers. <em>SQL server listens for a connection on TCP port 1433 by default</em>.</li>
</ul>
<h3 id="initialize-sql-server-in-docker-container">Initialize SQL server in Docker container</h3>
<p>Add the following lines to the docker file to initialize SQL Server.</p>
<pre><code class="language-docker hljs"><span class="hljs-keyword">RUN</span><span class="bash"> mkdir -p /usr/work
</span><span class="hljs-keyword">COPY</span><span class="bash"> ./build/*.sql /usr/work/
</span>
<span class="hljs-keyword">WORKDIR</span><span class="bash"> /usr/work
</span>
<span class="hljs-keyword">RUN</span><span class="bash"> ( /opt/mssql/bin/sqlservr &amp; ) \
    | grep -q <span class="hljs-string">"Service Broker manager has started"</span> \
    &amp;&amp; /opt/mssql-tools/bin/sqlcmd -S localhost -U SA -P <span class="hljs-variable">$SA_PASSWORD</span> -i create-db.sql \
    &amp;&amp; pkill sqlservr
</span></code></pre>
<ul>
<li><strong>Line #1</strong>: Run a command to create a new directory creating all the directories in the path.</li>
<li><strong>Line #2</strong>: Copy all the SQL files into the created directory.</li>
<li><strong>Line #4</strong>: Set the working directory for the subsequent instructions.</li>
<li><strong>Line #6</strong>: Starts the SQL server.</li>
<li><strong>Line #7</strong>: Wait for <em>sqlservr</em> to start by checking the logs. <em>grep</em> will block until it has found the string and then exit.</li>
<li><strong>Line #8</strong>: Run <em>sqlcmd</em> to run <em>create-db.sql</em> which scaffolds our database.</li>
<li><strong>Line #9</strong>: Kill the <em>sqlservr</em> process.</li>
</ul>
<h3 id="script-to-scaffold-our-database">Script to scaffold our database</h3>
<p>In our SQL script, we can do whatever we need to do at startup. In this demo, we will just create a database with a schema.</p>
<pre><code class="language-sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> DemoDb;
GO
<span class="hljs-keyword">USE</span> DemoDb;
GO

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> [dbo].[Table1]
(
    [<span class="hljs-keyword">Id</span>] <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">IDENTITY</span>,
    [<span class="hljs-keyword">Name</span>] <span class="hljs-keyword">NVARCHAR</span>(<span class="hljs-number">200</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
)

<span class="hljs-keyword">GO</span>
</code></pre>
<h3 id="running-the-container">Running the container</h3>
<p>We can use the following command to run start the DB using from the root folder.</p>
<pre><code class="language-bash hljs">docker-compose <span class="hljs-_">-f</span> ./build/docker-compose.yml up <span class="hljs-_">-d</span> --force-recreate --build db
</code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>Starting a new Docker container with Microsoft SQL Server is really simple. However, there are a few hoops to jump through. I hope that it’s easy to understand how it works after reading this article.</p>
<p>Please let me know your thoughts about this article if you have any suggestions or share the article with others.</p>
</body></html>



<aside class="hidden md:block mt-12">
        <div class="flex justify-center gap-x-5 ">
            <a class="bg-social-twitter social-button" href="https://twitter.com/intent/tweet?url=https://www.ankursheel.com/blog/run-sql-server-docker-container&text=In%20this%20post%2C%20we%20will%20see%20how%20we%20can%20run%20SQL%20Server%20on%20Docker%20using%20docker-compose%20and%20managing%20the%20image%20and%20environment%20variables%20in%20a%20docker%20file via @ankur_sheel" target="_blank" rel="noopener noreferrer">Tweet this Article</a>
            <a class="bg-social-linkedin social-button" href="https://www.linkedin.com/sharing/share-offsite/?url=https://www.ankursheel.com/blog/run-sql-server-docker-container"target="_blank" rel="noopener noreferrer">Share on Linkedin</a>
        </div>
</aside>



        </article>
    </div>
</main>

<footer class="shadow-lg z-10 w-full bg-gray-500 text-white">
    
<div class="flex justify-between items-center max-w-6xl mx-auto px-4 py-3 mt-14">
    <div class="flex">
        <a class="mr-4" href="https://twitter.com/ankur_sheel" title="Connect on Twitter" target="_blank" rel="noopener noreferrer">
            <svg width="32" height="32" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M7.23336 4.69629C7.23336 2.96884 8.63335 1.56857 10.36 1.56857C11.3736 1.56857 12.183 2.04804 12.7254 2.74385C13.3079 2.62467 13.8557 2.40913 14.3513 2.11508C14.1559 2.72598 13.7424 3.2396 13.2033 3.56463C13.2038 3.56568 13.2042 3.56674 13.2047 3.56779C13.7334 3.50361 14.2364 3.36302 14.7048 3.15546L14.7037 3.15715C14.3667 3.66183 13.9431 4.10736 13.4561 4.47034C13.4823 4.64672 13.4956 4.82427 13.4956 5.00079C13.4956 8.6871 10.6873 12.9746 5.52122 12.9746C3.93906 12.9746 2.46544 12.511 1.22505 11.7152C0.992632 11.5661 0.925108 11.2568 1.07423 11.0244C1.0874 11.0038 1.10183 10.9846 1.11734 10.9666C1.20582 10.8202 1.37438 10.7309 1.5554 10.7522C2.47066 10.8601 3.38568 10.7485 4.19219 10.3962C3.39226 10.0434 2.77129 9.35975 2.50204 8.51974C2.45359 8.3686 2.48835 8.20311 2.59351 8.08422C2.59716 8.0801 2.60087 8.07606 2.60464 8.0721C1.96391 7.50819 1.55973 6.68208 1.55973 5.76143V5.72759C1.55973 5.56814 1.64411 5.42059 1.78155 5.33974C1.82671 5.31317 1.87537 5.29511 1.92532 5.28558C1.70549 4.86154 1.58116 4.37984 1.58116 3.86958C1.58116 3.40165 1.58384 2.81192 1.91332 2.28081C1.98718 2.16175 2.10758 2.08915 2.2364 2.07195C2.42588 2.01237 2.64087 2.06969 2.77406 2.23302C3.86536 3.57126 5.44066 4.49583 7.23366 4.73961L7.23336 4.69629ZM5.52122 11.9746C4.73387 11.9746 3.97781 11.8435 3.27248 11.6023C4.13012 11.4538 4.95307 11.1159 5.66218 10.5602C5.81211 10.4427 5.87182 10.2435 5.81126 10.0629C5.7507 9.88234 5.583 9.75943 5.39255 9.75607C4.68968 9.74366 4.06712 9.39716 3.67793 8.86845C3.86828 8.85306 4.05428 8.82039 4.23445 8.77167C4.43603 8.71716 4.57363 8.53114 4.56674 8.32243C4.55985 8.11372 4.41029 7.93718 4.20555 7.89607C3.42694 7.73977 2.79883 7.16764 2.56169 6.42174C2.76255 6.47025 2.97102 6.4991 3.18482 6.5061C3.38563 6.51267 3.56646 6.38533 3.62795 6.19405C3.68943 6.00277 3.61666 5.79391 3.44963 5.68224C2.86523 5.29155 2.48116 4.62464 2.48116 3.86958C2.48116 3.70213 2.48352 3.55268 2.49355 3.41719C3.85115 4.79913 5.70873 5.68931 7.77588 5.79338C7.93225 5.80126 8.08328 5.73543 8.18395 5.61553C8.28463 5.49562 8.32332 5.33548 8.28851 5.18284C8.25255 5.02517 8.23336 4.86284 8.23336 4.69629C8.23336 3.52085 9.18591 2.56857 10.36 2.56857C11.5943 2.56857 12.4956 3.71208 12.4956 5.00079C12.4956 8.25709 10.0202 11.9746 5.52122 11.9746Z" fill="currentColor"></path>
            </svg>
        </a>
        <a class="mr-4" href="https://www.linkedin.com/in/ankursheel" title="View my LinkedIn profile" target="_blank" rel="noopener noreferrer">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                <path d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.968v16h4.969v-8.399c0-4.67 6.029-5.052 6.029 0v8.399h4.988v-10.131c0-7.88-8.922-7.593-11.018-3.714v-2.155z" fill="currentColor"></path>
            </svg>
        </a>

        <a class="mr-4" href="https://github.com/AnkurSheel" title="Check out my work on Github" target="_blank" rel="noopener noreferrer">
            <svg width="32" height="32" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M7.49936 0.850006C3.82767 0.850006 0.849976 3.8273 0.849976 7.50023C0.849976 10.4379 2.75523 12.9306 5.39775 13.8104C5.73047 13.8712 5.85171 13.6658 5.85171 13.4895C5.85171 13.3315 5.846 12.9135 5.84273 12.3587C3.99301 12.7604 3.60273 11.4671 3.60273 11.4671C3.30022 10.6988 2.86423 10.4942 2.86423 10.4942C2.26044 10.0819 2.90995 10.0901 2.90995 10.0901C3.57742 10.137 3.9285 10.7755 3.9285 10.7755C4.52167 11.7916 5.48512 11.4981 5.86396 11.3279C5.92438 10.8984 6.09625 10.6053 6.28608 10.4391C4.80948 10.2709 3.25695 9.70063 3.25695 7.15241C3.25695 6.42615 3.51618 5.83298 3.94157 5.368C3.87299 5.1998 3.64478 4.52375 4.00689 3.60807C4.00689 3.60807 4.56494 3.42926 5.83538 4.28941C6.36568 4.14204 6.93477 4.06856 7.50018 4.0657C8.06518 4.06856 8.63386 4.14204 9.16498 4.28941C10.4346 3.42926 10.9918 3.60807 10.9918 3.60807C11.3548 4.52375 11.1266 5.1998 11.0584 5.368C11.4846 5.83298 11.7418 6.42615 11.7418 7.15241C11.7418 9.70716 10.1868 10.2693 8.70571 10.4338C8.94412 10.6392 9.15681 11.045 9.15681 11.6655C9.15681 12.5542 9.14865 13.2715 9.14865 13.4895C9.14865 13.6675 9.26867 13.8745 9.60588 13.8095C12.2464 12.9282 14.15 10.4375 14.15 7.50023C14.15 3.8273 11.1723 0.850006 7.49936 0.850006Z" fill="currentColor"></path>
            </svg>
        </a>

        <a href="https://www.buymeacoffee.com/ankursheel" title="Buy Me A Coffee" target="_blank" rel="noopener noreferrer">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-coffee">
                <path d="M18 8h1a4 4 0 0 1 0 8h-1"></path><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path><line x1="6" y1="1" x2="6" y2="4"></line><line x1="10" y1="1" x2="10" y2="4"></line><line x1="14" y1="1" x2="14" y2="4"></line>
            </svg>
        </a>
    </div>
    <div class="copy">
        © AnkurSheel 2021
    </div>
</div>

</footer>


<script src="/assets/js/blog.js"></script>
    <script data-goatcounter="https://ankursheel.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>



    <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="ankursheel" data-description="Support me on Buy me a coffee!" data-message="Did you learn something or find this summary interesting? Buy me a coffee" data-color="#40DCA5" data-position="Right" data-x_margin="18" data-y_margin="18"></script>


</body>
</html>
